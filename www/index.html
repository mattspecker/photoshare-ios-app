<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval' data: blob: https:; frame-ancestors 'self' capacitor: ionic: file:; connect-src 'self' https: wss: ws:;" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <title>PhotoShare</title>
    <meta name="description" content="Lovable Generated Project" />
    
    <!-- Critical CSS for immediate theme application to prevent black background -->
    <style>
      :root {
        --background: 0 0% 100%;
        --foreground: 222.2 84% 4.9%;
      }
      
      .dark {
        --background: 222.2 84% 4.9%;
        --foreground: 210 40% 98%;
      }
      
      html, body {
        margin: 0;
        padding: 0;
        background-color: hsl(var(--background)) !important;
        color: hsl(var(--foreground)) !important;
        transition: background-color 0.3s ease, color 0.3s ease;
        min-height: 100vh;
      }
      
      /* iOS status bar safe area handling for overlaysWebView: false */
      body {
        padding-top: env(safe-area-inset-top);
        padding-bottom: env(safe-area-inset-bottom);
        padding-left: env(safe-area-inset-left);
        padding-right: env(safe-area-inset-right);
      }
      
      /* Prevent any black backgrounds during initial load */
      #root, #initial-loader, .initial-loading-screen {
        background-color: inherit !important;
        color: inherit !important;
      }
    </style>
    <meta name="author" content="Lovable" />
    <link rel="icon" href="/lovable-uploads/appicon1024x1024.png" type="image/png">

    <!-- Resource hints for critical services -->
    <link rel="dns-prefetch" href="https://jgfcfdlfcnmaripgpepl.supabase.co">
    <link rel="preconnect" href="https://jgfcfdlfcnmaripgpepl.supabase.co" crossorigin>

    <meta property="og:title" content="PhotoShare" />
    <meta property="og:description" content="Lovable Generated Project" />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="https://lovable.dev/opengraph-image-p98pqg.png" />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site" content="@lovable_dev" />
    <meta name="twitter:image" content="https://lovable.dev/opengraph-image-p98pqg.png" />
    
    <!-- Critical: Load ALL override scripts BEFORE main app bundle -->
    <!-- This ensures Camera overrides are set up before ES6 imports are cached -->
    
    <!-- Permission Gate - MUST load FIRST to block premature auto-upload -->
    <script src="/js/permissions-gate.js"></script>
    
    <!-- Loading Coordinator - Manages initialization order -->
    <script src="/js/loading-coordinator.js"></script>
    
    <!-- Auth Bridge - Loads on iOS and Android -->
    <script>
      // Load auth bridge on both iOS and Android
      const platform = window.Capacitor?.getPlatform?.();
      if (platform === 'ios' || platform === 'android') {
        const authBridgeScript = document.createElement('script');
        authBridgeScript.src = '/js/ios-jwt-auth-bridge.js';
        document.head.appendChild(authBridgeScript);
      }
      
      // Platform-specific FCM handlers
      if (platform === 'ios') {
        const iosFcmScript = document.createElement('script');
        iosFcmScript.src = '/js/ios-fcm-handler.js';
        document.head.appendChild(iosFcmScript);
      } else if (platform === 'android') {
        const androidFcmScript = document.createElement('script');
        androidFcmScript.src = '/js/android-fcm-handler.js';
        document.head.appendChild(androidFcmScript);
      }
    </script>
    <script src="/js/capacitor-push-notifications.js"></script>
    <script src="/js/photo-share-app-integration.js" defer></script>
    <script src="/js/website-integration.js" defer></script>
    <script src="/js/photo-duplicate-prevention.js" defer></script>
    <script src="/js/chunked-jwt-implementation.js"></script>
    <script src="/js/photoshare-app-integration-inline.js"></script>
    <script src="/js/native-plugin-auth-helper.js"></script>
    <script src="/js/web-app-ready-signal.js"></script>
    
    <!-- Theme initialization for status bar background -->
    <script>
      // Initialize theme immediately to prevent black status bar background
      (function() {
        // Check for saved theme preference or system preference
        const savedTheme = localStorage.getItem('theme');
        const systemTheme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
        const theme = savedTheme || systemTheme;
        
        // Apply theme to HTML element immediately
        if (theme === 'dark') {
          document.documentElement.classList.add('dark');
          // Set CSS custom properties for dark mode
          document.documentElement.style.setProperty('--background', '222.2 84% 4.9%');
          document.documentElement.style.setProperty('--foreground', '210 40% 98%');
        } else {
          document.documentElement.classList.remove('dark');
          // Set CSS custom properties for light mode  
          document.documentElement.style.setProperty('--background', '0 0% 100%');
          document.documentElement.style.setProperty('--foreground', '222.2 84% 4.9%');
        }
        
        // Apply background to body immediately
        document.body.style.backgroundColor = theme === 'dark' ? 'hsl(222.2 84% 4.9%)' : 'hsl(0 0% 100%)';
        document.body.style.color = theme === 'dark' ? 'hsl(210 40% 98%)' : 'hsl(222.2 84% 4.9%)';
        
        // Function to apply theme
        const applyTheme = (isDark) => {
          if (isDark) {
            document.documentElement.classList.add('dark');
            document.documentElement.style.setProperty('--background', '222.2 84% 4.9%');
            document.documentElement.style.setProperty('--foreground', '210 40% 98%');
            document.body.style.backgroundColor = 'hsl(222.2 84% 4.9%)';
            document.body.style.color = 'hsl(210 40% 98%)';
          } else {
            document.documentElement.classList.remove('dark');
            document.documentElement.style.setProperty('--background', '0 0% 100%');
            document.documentElement.style.setProperty('--foreground', '222.2 84% 4.9%');
            document.body.style.backgroundColor = 'hsl(0 0% 100%)';
            document.body.style.color = 'hsl(222.2 84% 4.9%)';
          }
        };
        
        // Listen for theme changes
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
          if (!localStorage.getItem('theme')) {
            applyTheme(e.matches);
          }
        });
        
        // Listen for storage changes (when theme is changed in web app)
        window.addEventListener('storage', (e) => {
          if (e.key === 'theme') {
            applyTheme(e.newValue === 'dark');
          }
        });
      })();
    </script>
    
    <!-- Google Fonts for Photo Editor and Theme Variations -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Poppins:wght@300;400;500;600;700&family=Montserrat:wght@300;400;500;600;700&family=Open+Sans:wght@300;400;500;600;700&family=Lato:wght@300;400;700&family=Oswald:wght@300;400;500;600;700&family=Raleway:wght@300;400;500;600;700&family=Nunito:wght@300;400;500;600;700&family=Source+Sans+Pro:wght@300;400;600;700&family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@400;500;600;700&family=Merriweather:wght@300;400;700&family=PT+Sans:wght@400;700&family=Ubuntu:wght@300;400;500;700&family=Work+Sans:wght@300;400;500;600;700&family=Quicksand:wght@300;400;500;600;700&family=Rubik:wght@300;400;500;600;700&family=Fira+Sans:wght@300;400;500;600;700&family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script type="module" crossorigin src="/assets/index-DJafiPoS.js"></script>
    <link rel="stylesheet" crossorigin href="/assets/index-CtwFNlw1.css">
  </head>

  <body style="margin: 0; background-color: white; color: #1a1a1a; transition: background-color 0.3s ease, color 0.3s ease;">
    <!-- Immediate theme application script - runs before any content loads -->
    <script>
      (function() {
        // Apply theme immediately - this is critical for status bar background
        const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
        const savedTheme = localStorage.getItem('theme');
        const theme = savedTheme || (prefersDark ? 'dark' : 'light');
        
        console.log('Theme initialization:', { savedTheme, prefersDark, theme });
        
        if (theme === 'dark') {
          document.documentElement.classList.add('dark');
          console.log('Applied dark theme');
        } else {
          document.documentElement.classList.remove('dark');
          console.log('Applied light theme');
        }
      })();
    </script>

    <!-- Initial loading screen - shows before React loads -->
    <div id="initial-loader" class="initial-loading-screen">
      <div class="loading-content">
        <div class="loading-logo">
          <div class="camera-icon">
            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <rect x="3" y="6" width="18" height="12" rx="2" stroke="currentColor" stroke-width="2"/>
              <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2"/>
              <path d="M16 6h2a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-2" stroke="currentColor" stroke-width="2"/>
            </svg>
          </div>
        </div>
        <h1 class="loading-title">PhotoShare</h1>
        <div class="loading-spinner">
          <div class="spinner-ring"></div>
        </div>
        <p class="loading-text">Loading...</p>
      </div>
    </div>
    
    <div id="root"></div>
    
    <!-- Native Gallery Integration -->
    <script src="/js/native-gallery-integration.js"></script>
    
    <!-- Main app bundle loads AFTER all overrides are ready -->
    
    <!-- Hide initial loader when React takes over -->
    <script>
      // Hide the initial loader once React starts rendering
      window.addEventListener('DOMContentLoaded', function() {
        // Add a small delay to ensure smooth transition
        setTimeout(function() {
          const loader = document.getElementById('initial-loader');
          if (loader && document.querySelector('#root').children.length > 0) {
            loader.style.opacity = '0';
            setTimeout(() => loader.remove(), 300);
          }
        }, 100);
      });
      
      // Also check periodically if React has rendered
      const checkReactLoaded = setInterval(function() {
        const rootElement = document.querySelector('#root');
        if (rootElement && rootElement.children.length > 0) {
          const loader = document.getElementById('initial-loader');
          if (loader) {
            loader.style.opacity = '0';
            setTimeout(() => loader.remove(), 300);
          }
          clearInterval(checkReactLoaded);
        }
      }, 50);
      
      // Fallback: remove loader after 10 seconds regardless
      setTimeout(function() {
        const loader = document.getElementById('initial-loader');
        if (loader) {
          loader.style.opacity = '0';
          setTimeout(() => loader.remove(), 300);
        }
        clearInterval(checkReactLoaded);
      }, 10000);
    </script>
  </body>
</html>
