<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval' data: blob: https:; frame-ancestors 'self' capacitor: ionic: file:; connect-src 'self' https: wss: ws:;" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <title>PhotoShare</title>
    <meta name="description" content="Lovable Generated Project" />
    <meta name="author" content="Lovable" />
    <link rel="icon" href="/lovable-uploads/appicon1024x1024.png" type="image/png">

    <!-- Resource hints for critical services -->
    <link rel="dns-prefetch" href="https://jgfcfdlfcnmaripgpepl.supabase.co">
    <link rel="preconnect" href="https://jgfcfdlfcnmaripgpepl.supabase.co" crossorigin>

    <meta property="og:title" content="PhotoShare" />
    <meta property="og:description" content="Lovable Generated Project" />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="https://lovable.dev/opengraph-image-p98pqg.png" />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site" content="@lovable_dev" />
    <meta name="twitter:image" content="https://lovable.dev/opengraph-image-p98pqg.png" />
    
    <!-- Critical: Load ALL override scripts BEFORE main app bundle -->
    <!-- This ensures Camera overrides are set up before ES6 imports are cached -->
    
    <!-- Permission Gate - MUST load FIRST to block premature auto-upload -->
    <script src="/js/permissions-gate.js"></script>
    
    <!-- Loading Coordinator - Manages initialization order -->
    <script src="/js/loading-coordinator.js"></script>
    
    <!-- Auth Bridge - Loads on iOS and Android -->
    <script>
      // Load auth bridge on both iOS and Android
      const platform = window.Capacitor?.getPlatform?.();
      if (platform === 'ios' || platform === 'android') {
        const authBridgeScript = document.createElement('script');
        authBridgeScript.src = '/js/ios-jwt-auth-bridge.js';
        document.head.appendChild(authBridgeScript);
      }
      
      // Platform-specific FCM handlers
      if (platform === 'ios') {
        const iosFcmScript = document.createElement('script');
        iosFcmScript.src = '/js/ios-fcm-handler.js';
        document.head.appendChild(iosFcmScript);
      } else if (platform === 'android') {
        const androidFcmScript = document.createElement('script');
        androidFcmScript.src = '/js/android-fcm-handler.js';
        document.head.appendChild(androidFcmScript);
      }
    </script>
    <script src="/js/capacitor-push-notifications.js"></script>
    <script src="/js/photo-share-app-integration.js" defer></script>
    <script src="/js/website-integration.js" defer></script>
    <script src="/js/photo-duplicate-prevention.js" defer></script>
    <script src="/js/chunked-jwt-implementation.js"></script>
    <script src="/js/photoshare-app-integration-inline.js"></script>
    <script src="/js/native-plugin-auth-helper.js"></script>
    <script src="/js/web-app-ready-signal.js"></script>
    
    <!-- Google Fonts for Photo Editor and Theme Variations -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Poppins:wght@300;400;500;600;700&family=Montserrat:wght@300;400;500;600;700&family=Open+Sans:wght@300;400;500;600;700&family=Lato:wght@300;400;700&family=Oswald:wght@300;400;500;600;700&family=Raleway:wght@300;400;500;600;700&family=Nunito:wght@300;400;500;600;700&family=Source+Sans+Pro:wght@300;400;600;700&family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@400;500;600;700&family=Merriweather:wght@300;400;700&family=PT+Sans:wght@400;700&family=Ubuntu:wght@300;400;500;700&family=Work+Sans:wght@300;400;500;600;700&family=Quicksand:wght@300;400;500;600;700&family=Rubik:wght@300;400;500;600;700&family=Fira+Sans:wght@300;400;500;600;700&family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script type="module" crossorigin src="/assets/index-DJafiPoS.js"></script>
    <link rel="stylesheet" crossorigin href="/assets/index-CtwFNlw1.css">
  </head>

  <body>
    <!-- Initial loading screen - shows before React loads -->
    <div id="initial-loader" class="initial-loading-screen">
      <div class="loading-content">
        <div class="loading-logo">
          <div class="camera-icon">
            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <rect x="3" y="6" width="18" height="12" rx="2" stroke="currentColor" stroke-width="2"/>
              <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2"/>
              <path d="M16 6h2a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-2" stroke="currentColor" stroke-width="2"/>
            </svg>
          </div>
        </div>
        <h1 class="loading-title">PhotoShare</h1>
        <div class="loading-spinner">
          <div class="spinner-ring"></div>
        </div>
        <p class="loading-text">Loading...</p>
      </div>
    </div>
    
    <div id="root"></div>
    
    <!-- Native Gallery Integration -->
    <script src="/js/native-gallery-integration.js"></script>
    
    <!-- Main app bundle loads AFTER all overrides are ready -->
    
    <!-- Hide initial loader when React takes over -->
    <script>
      // Hide the initial loader once React starts rendering
      window.addEventListener('DOMContentLoaded', function() {
        // Add a small delay to ensure smooth transition
        setTimeout(function() {
          const loader = document.getElementById('initial-loader');
          if (loader && document.querySelector('#root').children.length > 0) {
            loader.style.opacity = '0';
            setTimeout(() => loader.remove(), 300);
          }
        }, 100);
      });
      
      // Also check periodically if React has rendered
      const checkReactLoaded = setInterval(function() {
        const rootElement = document.querySelector('#root');
        if (rootElement && rootElement.children.length > 0) {
          const loader = document.getElementById('initial-loader');
          if (loader) {
            loader.style.opacity = '0';
            setTimeout(() => loader.remove(), 300);
          }
          clearInterval(checkReactLoaded);
        }
      }, 50);
      
      // Fallback: remove loader after 10 seconds regardless
      setTimeout(function() {
        const loader = document.getElementById('initial-loader');
        if (loader) {
          loader.style.opacity = '0';
          setTimeout(() => loader.remove(), 300);
        }
        clearInterval(checkReactLoaded);
      }, 10000);
    </script>
  </body>
</html>
