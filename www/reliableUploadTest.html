<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Reliable Upload System Test</title>
  <style>
    * {
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      margin: 0;
      padding: 20px;
      background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
      min-height: 100vh;
      color: #333;
    }
    
    .main-container {
      max-width: 1000px;
      margin: 0 auto;
      background: rgba(255, 255, 255, 0.95);
      border-radius: 15px;
      padding: 25px;
      box-shadow: 0 15px 50px rgba(0, 0, 0, 0.1);
    }
    
    .header {
      text-align: center;
      margin-bottom: 30px;
      padding-bottom: 20px;
      border-bottom: 2px solid #e9ecef;
    }
    
    .header h1 {
      margin: 0;
      color: #2c3e50;
      font-size: 2.2rem;
    }
    
    .status-dashboard {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 15px;
      margin-bottom: 25px;
    }
    
    .status-card {
      background: white;
      border: 1px solid #dee2e6;
      border-radius: 12px;
      padding: 18px;
      text-align: center;
      box-shadow: 0 3px 12px rgba(0, 0, 0, 0.05);
    }
    
    .status-value {
      font-size: 1.8rem;
      font-weight: bold;
      margin: 8px 0;
    }
    
    .status-label {
      color: #6c757d;
      font-size: 0.85rem;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .network-online { color: #28a745; }
    .network-offline { color: #dc3545; }
    .status-uploading { color: #ffc107; }
    .status-queued { color: #17a2b8; }
    .status-completed { color: #28a745; }
    .status-failed { color: #dc3545; }
    
    .feature-sections {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-bottom: 25px;
    }
    
    .feature-section {
      background: #f8f9fa;
      border-radius: 12px;
      padding: 20px;
      border-left: 4px solid #4CAF50;
    }
    
    .feature-section h3 {
      margin: 0 0 15px 0;
      color: #2c3e50;
      font-size: 1.2rem;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    button {
      background: linear-gradient(135deg, #4CAF50, #45a049);
      color: white;
      border: none;
      padding: 10px 16px;
      border-radius: 6px;
      margin: 4px;
      cursor: pointer;
      font-size: 0.9rem;
      transition: all 0.3s ease;
      min-width: 120px;
    }
    
    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);
    }
    
    .btn-test { background: linear-gradient(135deg, #2196F3, #1976D2); }
    .btn-status { background: linear-gradient(135deg, #FF9800, #F57C00); }
    .btn-network { background: linear-gradient(135deg, #9C27B0, #7B1FA2); }
    .btn-clear { background: linear-gradient(135deg, #607D8B, #455A64); }
    
    .upload-progress {
      background: white;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 3px 12px rgba(0, 0, 0, 0.05);
    }
    
    .progress-bar {
      background: #e9ecef;
      border-radius: 8px;
      height: 16px;
      margin: 12px 0;
      overflow: hidden;
    }
    
    .progress-fill {
      background: linear-gradient(90deg, #4CAF50, #45a049);
      height: 100%;
      border-radius: 8px;
      transition: width 0.5s ease;
      position: relative;
    }
    
    .organizer-status {
      background: linear-gradient(135deg, #E3F2FD, #BBDEFB);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
      border-left: 4px solid #2196F3;
    }
    
    .organizer-status h3 {
      margin: 0 0 15px 0;
      color: #1976D2;
      font-size: 1.3rem;
    }
    
    .status-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 12px;
      margin: 15px 0;
    }
    
    .status-metric {
      background: rgba(255, 255, 255, 0.8);
      border-radius: 8px;
      padding: 12px;
      text-align: center;
    }
    
    .metric-number {
      font-size: 1.5rem;
      font-weight: bold;
      color: #1976D2;
      margin-bottom: 4px;
    }
    
    .metric-label {
      font-size: 0.8rem;
      color: #5f6368;
    }
    
    .log-container {
      background: #2d3748;
      color: #e2e8f0;
      border-radius: 12px;
      padding: 20px;
      font-family: 'Monaco', 'Menlo', 'SF Mono', monospace;
      font-size: 0.85rem;
      line-height: 1.5;
      max-height: 400px;
      overflow-y: auto;
      white-space: pre-wrap;
      box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.3);
    }
    
    .network-status {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 12px;
      border-radius: 20px;
      font-size: 0.9rem;
      font-weight: 500;
      margin: 10px 0;
    }
    
    .network-wifi {
      background: rgba(76, 175, 80, 0.1);
      color: #388E3C;
      border: 1px solid rgba(76, 175, 80, 0.3);
    }
    
    .network-cellular {
      background: rgba(255, 152, 0, 0.1);
      color: #F57C00;
      border: 1px solid rgba(255, 152, 0, 0.3);
    }
    
    .network-offline {
      background: rgba(244, 67, 54, 0.1);
      color: #D32F2F;
      border: 1px solid rgba(244, 67, 54, 0.3);
    }
    
    .text-report {
      background: #f8f9fa;
      border-radius: 8px;
      padding: 15px;
      font-family: monospace;
      font-size: 0.9rem;
      white-space: pre-line;
      border: 1px solid #dee2e6;
      margin-top: 15px;
    }
    
    @media (max-width: 768px) {
      .main-container {
        margin: 10px;
        padding: 15px;
      }
      
      .feature-sections {
        grid-template-columns: 1fr;
      }
      
      .status-dashboard {
        grid-template-columns: repeat(2, 1fr);
      }
    }
  </style>
</head>
<body>
  <div class="main-container">
    <!-- Header -->
    <div class="header">
      <h1>üì° Reliable Upload System</h1>
      <p style="margin: 10px 0 0 0; color: #6c757d;">Ensuring photos reach the event for guests to download</p>
      
      <!-- Network Status -->
      <div class="network-status network-wifi" id="network-status">
        <span>üì∂</span>
        <span id="network-text">WiFi Connected</span>
      </div>
    </div>

    <!-- Status Dashboard -->
    <div class="status-dashboard">
      <div class="status-card">
        <div class="status-value network-online" id="upload-success-rate">100%</div>
        <div class="status-label">Success Rate</div>
      </div>
      <div class="status-card">
        <div class="status-value" id="photos-uploaded">0</div>
        <div class="status-label">Photos Uploaded</div>
      </div>
      <div class="status-card">
        <div class="status-value status-queued" id="photos-queued">0</div>
        <div class="status-label">In Queue</div>
      </div>
      <div class="status-card">
        <div class="status-value" id="retry-count">0</div>
        <div class="status-label">Retries</div>
      </div>
      <div class="status-card">
        <div class="status-value" id="upload-speed">0</div>
        <div class="status-label">MB/min</div>
      </div>
    </div>

    <!-- Upload Progress -->
    <div class="upload-progress">
      <h3>üì§ Current Upload Progress</h3>
      <div class="progress-bar">
        <div class="progress-fill" id="upload-progress" style="width: 0%"></div>
      </div>
      <div style="display: flex; justify-content: space-between; font-size: 0.9rem; color: #6c757d;">
        <span id="progress-text">Ready to upload</span>
        <span id="progress-percent">0%</span>
      </div>
    </div>

    <!-- Event Organizer Status -->
    <div class="organizer-status">
      <h3>üìä Event Organizer Dashboard</h3>
      <p style="margin: 0 0 15px 0; color: #5f6368;">Real-time status for event organizers</p>
      
      <div class="status-grid">
        <div class="status-metric">
          <div class="metric-number" id="org-ready-photos">0</div>
          <div class="metric-label">Ready for Guests</div>
        </div>
        <div class="status-metric">
          <div class="metric-number" id="org-processing">0</div>
          <div class="metric-label">Still Processing</div>
        </div>
        <div class="status-metric">
          <div class="metric-number" id="org-issues">0</div>
          <div class="metric-label">Issues</div>
        </div>
        <div class="status-metric">
          <div class="metric-number" id="org-progress">0%</div>
          <div class="metric-label">Overall Progress</div>
        </div>
      </div>
      
      <div style="margin-top: 15px; padding: 10px; background: rgba(255,255,255,0.7); border-radius: 6px; font-size: 0.9rem;">
        <strong>Status:</strong> <span id="org-status-text">No uploads yet</span>
      </div>
      
      <div class="text-report" id="organizer-report" style="display: none;"></div>
    </div>

    <!-- Feature Sections -->
    <div class="feature-sections">
      <!-- Reliable Upload Testing -->
      <div class="feature-section">
        <h3>üì° Reliable Upload</h3>
        <button onclick="testSingleUpload()" class="btn-test">üì∏ Test Single Upload</button>
        <button onclick="testBatchUpload()" class="btn-test">üì± Test Batch Upload</button>
        <button onclick="showUploadStats()" class="btn-status">üìä Upload Statistics</button>
      </div>

      <!-- Network Simulation -->
      <div class="feature-section">
        <h3>üì∂ Network Simulation</h3>
        <button onclick="simulateWiFi()" class="btn-network">üì∂ WiFi Connection</button>
        <button onclick="simulateCellular()" class="btn-network">üì± Cellular Connection</button>
        <button onclick="simulateNetworkIssues()" class="btn-network">‚ö†Ô∏è Network Issues</button>
        <button onclick="simulateOffline()" class="btn-network">‚ùå Go Offline</button>
      </div>

      <!-- Status Sharing -->
      <div class="feature-section">
        <h3>üìä Status Sharing</h3>
        <button onclick="generateOrganizerReport()" class="btn-status">üìÑ Generate Report</button>
        <button onclick="testStatusSharing()" class="btn-test">üß™ Test Status Sharing</button>
        <button onclick="clearEventData()" class="btn-clear">üßπ Clear Event Data</button>
      </div>

      <!-- System Controls -->
      <div class="feature-section">
        <h3>‚öôÔ∏è System Controls</h3>
        <button onclick="initializeReliableSystem()" class="btn-test">üîß Initialize System</button>
        <button onclick="showSystemStatus()" class="btn-status">üìã System Status</button>
        <button onclick="runComprehensiveTest()" class="btn-test">üöÄ Full Test Suite</button>
        <button onclick="clearLog()" class="btn-clear">üßπ Clear Log</button>
      </div>
    </div>

    <!-- Log Container -->
    <div class="log-container" id="upload-log">Reliable Upload System Test Console
=====================================
üì° Network-aware photo upload with retry mechanisms
üìä Real-time status sharing for event organizers
üîÑ Automatic quality adaptation and error recovery

Ready for reliable upload testing...

</div>
  </div>

  <script>
    // Global state
    let reliableUploadState = {
      initialized: false,
      networkType: 'wifi',
      isOnline: true,
      totalUploads: 0,
      successfulUploads: 0,
      failedUploads: 0,
      retriedUploads: 0,
      currentEventId: 'test_event_123',
      uploadSpeed: 0,
      uploadProgress: 0,
      organizerStats: {
        readyForGuests: 0,
        processing: 0,
        issues: 0,
        overallProgress: 0
      }
    };

    function log(message, level = 'info') {
      const logElement = document.getElementById('upload-log');
      const timestamp = new Date().toLocaleTimeString();
      
      let icon = 'üìù';
      let color = '#e2e8f0';
      
      switch(level) {
        case 'success': icon = '‚úÖ'; color = '#48bb78'; break;
        case 'error': icon = '‚ùå'; color = '#f56565'; break;
        case 'warning': icon = '‚ö†Ô∏è'; color = '#ed8936'; break;
        case 'info': icon = 'üí°'; color = '#4299e1'; break;
        case 'network': icon = 'üì°'; color = '#9f7aea'; break;
        case 'upload': icon = 'üì§'; color = '#38b2ac'; break;
        case 'organizer': icon = 'üìä'; color = '#ed64a6'; break;
      }
      
      const logEntry = `[${timestamp}] ${icon} ${message}\n`;
      logElement.textContent += logEntry;
      logElement.scrollTop = logElement.scrollHeight;
      console.log(message);
    }

    function updateDashboard() {
      // Update main dashboard
      document.getElementById('upload-success-rate').textContent = 
        reliableUploadState.totalUploads > 0 ? 
        `${((reliableUploadState.successfulUploads / reliableUploadState.totalUploads) * 100).toFixed(1)}%` : 
        '100%';
      
      document.getElementById('photos-uploaded').textContent = reliableUploadState.successfulUploads;
      document.getElementById('photos-queued').textContent = 
        reliableUploadState.totalUploads - reliableUploadState.successfulUploads - reliableUploadState.failedUploads;
      document.getElementById('retry-count').textContent = reliableUploadState.retriedUploads;
      document.getElementById('upload-speed').textContent = reliableUploadState.uploadSpeed.toFixed(1);

      // Update organizer dashboard
      const orgStats = reliableUploadState.organizerStats;
      document.getElementById('org-ready-photos').textContent = orgStats.readyForGuests;
      document.getElementById('org-processing').textContent = orgStats.processing;
      document.getElementById('org-issues').textContent = orgStats.issues;
      document.getElementById('org-progress').textContent = `${orgStats.overallProgress}%`;
      
      // Update status text
      let statusText = 'No uploads yet';
      if (orgStats.processing > 0) {
        statusText = `Uploading ${orgStats.processing} photos...`;
      } else if (orgStats.readyForGuests > 0) {
        statusText = `${orgStats.readyForGuests} photos ready for guests`;
      } else if (orgStats.issues > 0) {
        statusText = `${orgStats.issues} uploads need attention`;
      }
      document.getElementById('org-status-text').textContent = statusText;
    }

    function updateProgress(percentage, text) {
      reliableUploadState.uploadProgress = percentage;
      document.getElementById('upload-progress').style.width = `${percentage}%`;
      document.getElementById('progress-text').textContent = text || 'Uploading...';
      document.getElementById('progress-percent').textContent = `${percentage.toFixed(0)}%`;
    }

    function updateNetworkStatus(networkType, isOnline) {
      reliableUploadState.networkType = networkType;
      reliableUploadState.isOnline = isOnline;
      
      const statusElement = document.getElementById('network-status');
      const textElement = document.getElementById('network-text');
      
      if (!isOnline) {
        statusElement.className = 'network-status network-offline';
        textElement.textContent = 'Offline';
      } else if (networkType === 'wifi') {
        statusElement.className = 'network-status network-wifi';
        textElement.textContent = 'WiFi Connected';
      } else {
        statusElement.className = 'network-status network-cellular';
        textElement.textContent = 'Cellular Connected';
      }
    }

    // Initialize system
    async function initializeReliableSystem() {
      log('üîß Initializing Reliable Upload System...', 'info');
      updateProgress(10, 'Initializing...');
      
      await new Promise(resolve => setTimeout(resolve, 500));
      
      log('üì° Setting up network monitoring...', 'network');
      updateProgress(30, 'Network setup...');
      await new Promise(resolve => setTimeout(resolve, 400));
      
      log('üîÑ Configuring retry mechanisms...', 'info');
      updateProgress(60, 'Retry setup...');
      await new Promise(resolve => setTimeout(resolve, 400));
      
      log('üìä Initializing status sharing...', 'organizer');
      updateProgress(90, 'Status sharing...');
      await new Promise(resolve => setTimeout(resolve, 300));
      
      reliableUploadState.initialized = true;
      updateProgress(100, 'System ready');
      log('‚úÖ Reliable Upload System initialized successfully!', 'success');
      log('üì° Network monitoring active with retry mechanisms', 'success');
      log('üìä Status sharing enabled for event organizers', 'organizer');
      
      setTimeout(() => updateProgress(0, 'Ready to upload'), 2000);
    }

    // Test single upload
    async function testSingleUpload() {
      if (!reliableUploadState.initialized) {
        log('‚ö†Ô∏è Please initialize the system first', 'warning');
        return;
      }

      const photoName = `photo_${Date.now()}.jpg`;
      const photoSize = Math.floor(Math.random() * 5 + 2); // 2-7MB
      
      log(`üì§ Starting reliable upload: ${photoName} (${photoSize}MB)`, 'upload');
      log(`üì∂ Network: ${reliableUploadState.networkType}, Quality adapted: ${getQualityText()}`, 'network');
      
      reliableUploadState.totalUploads++;
      reliableUploadState.organizerStats.processing++;
      updateDashboard();
      
      // Simulate upload with potential issues
      let attempt = 1;
      const maxAttempts = 3;
      let success = false;
      
      while (attempt <= maxAttempts && !success) {
        log(`üîÑ Upload attempt ${attempt}/${maxAttempts}`, 'upload');
        updateProgress(10, `Attempt ${attempt}/${maxAttempts}`);
        
        // Simulate upload progress
        for (let progress = 10; progress <= 100; progress += 10) {
          await new Promise(resolve => setTimeout(resolve, getNetworkDelay()));
          updateProgress(progress, `Uploading ${photoName}`);
          
          // Simulate network issues
          if (Math.random() < getFailureRate() && progress < 100) {
            log(`‚ùå Upload failed at ${progress}%: Network timeout`, 'error');
            reliableUploadState.retriedUploads++;
            break;
          }
          
          if (progress === 100) {
            success = true;
            log(`‚úÖ Upload completed successfully: ${photoName}`, 'success');
            log(`   ‚ö° Speed: ${(photoSize / 2).toFixed(1)} MB/s`, 'upload');
            log(`   üìä Attempts: ${attempt}`, 'upload');
            
            reliableUploadState.successfulUploads++;
            reliableUploadState.organizerStats.readyForGuests++;
            reliableUploadState.organizerStats.processing--;
            reliableUploadState.organizerStats.overallProgress = 
              (reliableUploadState.successfulUploads / reliableUploadState.totalUploads) * 100;
            reliableUploadState.uploadSpeed = Math.random() * 3 + 1; // MB/min
          }
        }
        
        if (!success) {
          attempt++;
          if (attempt <= maxAttempts) {
            const retryDelay = Math.pow(2, attempt - 1); // Exponential backoff
            log(`‚è≥ Retrying in ${retryDelay} seconds...`, 'warning');
            await new Promise(resolve => setTimeout(resolve, retryDelay * 1000));
          }
        }
      }
      
      if (!success) {
        log(`üíÄ Upload permanently failed after ${maxAttempts} attempts`, 'error');
        reliableUploadState.failedUploads++;
        reliableUploadState.organizerStats.issues++;
        reliableUploadState.organizerStats.processing--;
      }
      
      updateDashboard();
      setTimeout(() => updateProgress(0, 'Ready for next upload'), 1000);
    }

    // Test batch upload
    async function testBatchUpload() {
      if (!reliableUploadState.initialized) {
        log('‚ö†Ô∏è Please initialize the system first', 'warning');
        return;
      }

      const batchSize = 5;
      log(`üì± Starting batch upload: ${batchSize} photos`, 'upload');
      log('üîÑ Concurrent uploads with retry mechanisms', 'upload');
      
      const uploadPromises = [];
      for (let i = 1; i <= batchSize; i++) {
        uploadPromises.push(simulateBatchPhoto(i, batchSize));
      }
      
      await Promise.all(uploadPromises);
      
      log('‚úÖ Batch upload completed', 'success');
      log(`üìä Final stats: ${reliableUploadState.successfulUploads} successful, ${reliableUploadState.failedUploads} failed`, 'success');
    }

    async function simulateBatchPhoto(photoNum, totalPhotos) {
      const photoName = `batch_photo_${photoNum}.jpg`;
      
      reliableUploadState.totalUploads++;
      reliableUploadState.organizerStats.processing++;
      updateDashboard();
      
      // Simulate individual photo upload
      await new Promise(resolve => setTimeout(resolve, Math.random() * 2000 + 1000));
      
      if (Math.random() > 0.2) { // 80% success rate
        reliableUploadState.successfulUploads++;
        reliableUploadState.organizerStats.readyForGuests++;
        log(`‚úÖ Batch photo ${photoNum}/${totalPhotos} completed: ${photoName}`, 'success');
      } else {
        reliableUploadState.failedUploads++;
        reliableUploadState.organizerStats.issues++;
        log(`‚ùå Batch photo ${photoNum}/${totalPhotos} failed: ${photoName}`, 'error');
      }
      
      reliableUploadState.organizerStats.processing--;
      reliableUploadState.organizerStats.overallProgress = 
        (reliableUploadState.successfulUploads / reliableUploadState.totalUploads) * 100;
      updateDashboard();
    }

    // Network simulation functions
    function simulateWiFi() {
      updateNetworkStatus('wifi', true);
      log('üì∂ Switched to WiFi - High quality uploads enabled', 'network');
    }

    function simulateCellular() {
      updateNetworkStatus('cellular', true);
      log('üì± Switched to Cellular - Quality adapted for bandwidth', 'network');
    }

    function simulateNetworkIssues() {
      log('‚ö†Ô∏è Network issues detected - Increasing retry attempts', 'warning');
      log('üîÑ Upload quality reduced, retry backoff increased', 'network');
    }

    function simulateOffline() {
      updateNetworkStatus('offline', false);
      log('‚ùå Network disconnected - Uploads paused', 'error');
      log('‚è≥ Will resume when connection returns', 'warning');
      
      // Simulate reconnection after 3 seconds
      setTimeout(() => {
        updateNetworkStatus('wifi', true);
        log('‚úÖ Network reconnected - Resuming uploads', 'success');
      }, 3000);
    }

    // Status and reporting functions
    function generateOrganizerReport() {
      log('üìÑ Generating organizer status report...', 'organizer');
      
      const report = `üìä Event Upload Status Report
Generated: ${new Date().toLocaleString()}
Event ID: ${reliableUploadState.currentEventId}

üì∏ Photo Statistics:
‚Ä¢ Ready for Guests: ${reliableUploadState.organizerStats.readyForGuests} photos
‚Ä¢ Still Processing: ${reliableUploadState.organizerStats.processing} photos  
‚Ä¢ Upload Issues: ${reliableUploadState.organizerStats.issues} photos
‚Ä¢ Overall Progress: ${reliableUploadState.organizerStats.overallProgress.toFixed(1)}%

üìä Upload Performance:
‚Ä¢ Success Rate: ${((reliableUploadState.successfulUploads / Math.max(reliableUploadState.totalUploads, 1)) * 100).toFixed(1)}%
‚Ä¢ Average Speed: ${reliableUploadState.uploadSpeed.toFixed(1)} MB/min
‚Ä¢ Network: ${reliableUploadState.networkType.toUpperCase()}
‚Ä¢ Retry Count: ${reliableUploadState.retriedUploads}

üéØ Status: ${reliableUploadState.organizerStats.processing > 0 ? 'Uploading in progress' : 
                reliableUploadState.organizerStats.readyForGuests > 0 ? 'Photos available for guests' : 
                'Ready for uploads'}`;

      const reportElement = document.getElementById('organizer-report');
      reportElement.textContent = report;
      reportElement.style.display = 'block';
      
      log('‚úÖ Organizer report generated', 'organizer');
    }

    function testStatusSharing() {
      log('üß™ Testing status sharing system...', 'organizer');
      
      // Simulate receiving status updates
      setTimeout(() => {
        log('üìä Status update: 3 photos queued for upload', 'organizer');
        reliableUploadState.organizerStats.processing = 3;
        updateDashboard();
      }, 1000);
      
      setTimeout(() => {
        log('üìä Status update: 1 photo completed, 2 still uploading', 'organizer');
        reliableUploadState.organizerStats.readyForGuests = 1;
        reliableUploadState.organizerStats.processing = 2;
        updateDashboard();
      }, 2500);
      
      setTimeout(() => {
        log('üìä Status update: All uploads completed!', 'organizer');
        reliableUploadState.organizerStats.readyForGuests = 3;
        reliableUploadState.organizerStats.processing = 0;
        reliableUploadState.organizerStats.overallProgress = 100;
        updateDashboard();
        log('‚úÖ Status sharing test completed', 'success');
      }, 4000);
    }

    function showUploadStats() {
      log('üìä Current Upload Statistics:', 'info');
      log(`‚Ä¢ Total Uploads: ${reliableUploadState.totalUploads}`, 'info');
      log(`‚Ä¢ Successful: ${reliableUploadState.successfulUploads}`, 'success');
      log(`‚Ä¢ Failed: ${reliableUploadState.failedUploads}`, 'error');
      log(`‚Ä¢ Retried: ${reliableUploadState.retriedUploads}`, 'warning');
      log(`‚Ä¢ Success Rate: ${((reliableUploadState.successfulUploads / Math.max(reliableUploadState.totalUploads, 1)) * 100).toFixed(1)}%`, 'info');
      log(`‚Ä¢ Average Speed: ${reliableUploadState.uploadSpeed.toFixed(1)} MB/min`, 'info');
      log(`‚Ä¢ Network: ${reliableUploadState.networkType} (${reliableUploadState.isOnline ? 'Online' : 'Offline'})`, 'network');
    }

    function showSystemStatus() {
      log('üìã Reliable Upload System Status:', 'info');
      log(`‚Ä¢ System: ${reliableUploadState.initialized ? 'Initialized' : 'Not Initialized'}`, 'info');
      log(`‚Ä¢ Network Monitoring: Active`, 'network');
      log(`‚Ä¢ Retry Mechanism: Exponential backoff enabled`, 'info');
      log(`‚Ä¢ Quality Adaptation: ${getQualityText()}`, 'network');
      log(`‚Ä¢ Status Sharing: Active for organizers`, 'organizer');
    }

    async function runComprehensiveTest() {
      if (!reliableUploadState.initialized) {
        await initializeReliableSystem();
        await new Promise(resolve => setTimeout(resolve, 1000));
      }
      
      log('üöÄ Running comprehensive reliable upload test...', 'info');
      
      // Test different network conditions
      simulateWiFi();
      await testSingleUpload();
      
      simulateCellular();
      await testSingleUpload();
      
      simulateNetworkIssues();
      await testSingleUpload();
      
      // Test batch upload
      await testBatchUpload();
      
      // Generate final report
      generateOrganizerReport();
      
      log('üéâ Comprehensive test completed!', 'success');
      showUploadStats();
    }

    // Utility functions
    function getNetworkDelay() {
      switch (reliableUploadState.networkType) {
        case 'wifi': return 100 + Math.random() * 100;
        case 'cellular': return 200 + Math.random() * 300;
        case 'offline': return 5000; // Long delay when offline
        default: return 200;
      }
    }

    function getFailureRate() {
      if (!reliableUploadState.isOnline) return 1.0; // Always fail when offline
      switch (reliableUploadState.networkType) {
        case 'wifi': return 0.05; // 5% failure rate
        case 'cellular': return 0.15; // 15% failure rate
        default: return 0.1;
      }
    }

    function getQualityText() {
      if (!reliableUploadState.isOnline) return 'Offline';
      switch (reliableUploadState.networkType) {
        case 'wifi': return 'High (95%)';
        case 'cellular': return 'Medium (80%)';
        default: return 'Auto-adapted';
      }
    }

    function clearEventData() {
      reliableUploadState.organizerStats = {
        readyForGuests: 0,
        processing: 0,
        issues: 0,
        overallProgress: 0
      };
      
      document.getElementById('organizer-report').style.display = 'none';
      updateDashboard();
      log('üßπ Event data cleared', 'info');
    }

    function clearLog() {
      document.getElementById('upload-log').textContent = `Reliable Upload System Test Console
=====================================
üì° Network-aware photo upload with retry mechanisms
üìä Real-time status sharing for event organizers
üîÑ Automatic quality adaptation and error recovery

Log cleared at ${new Date().toLocaleTimeString()}

`;
    }

    // Initialize on page load
    log('üì± Reliable Upload System Test loaded', 'success');
    log('üéØ Focus: Ensuring photos reach events for guest downloads', 'info');
    log('Click "Initialize System" to begin testing reliable uploads', 'info');
    updateDashboard();
  </script>
</body>
</html>