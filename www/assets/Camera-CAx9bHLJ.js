const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-DJafiPoS.js","assets/index-CtwFNlw1.css"])))=>i.map(i=>d[i]);
import{r,a as je,al as Ye,s as N,j as e,am as ee,B,ak as de,ai as Je,b as Qe,an as Xe,u as Ze,ao as Ke,ap as ve,d as et,aq as tt,ar as at,as as st,af as ot,C as xe,f as we,at as be,au as ye,A as Pe,av as it,aw as nt,ax as K,ay as rt,az as lt,aA as ct,aB as dt,aC as ut,_ as pt}from"./index-DJafiPoS.js";import{P as Ue}from"./progress-BaocU3Fv.js";import{C as mt}from"./circle-check-CtFdAZ6P.js";const ce={isVisible:!1,mode:"uploading",currentIndex:0,totalCount:0,currentFileName:"",currentThumbnail:"",progress:0,uploadedCount:0,duplicateCount:0,outsideDateCount:0};function ht(){const[n,g]=r.useState(ce),E=r.useCallback(l=>{g({...ce,isVisible:!0,mode:"uploading",totalCount:l})},[]),d=r.useCallback((l,u,o,f)=>{g(p=>({...p,currentIndex:l,currentFileName:u,currentThumbnail:o,progress:f}))},[]),a=r.useCallback(l=>{g(u=>({...u,uploadedCount:l==="success"?u.uploadedCount+1:u.uploadedCount,duplicateCount:l==="duplicate"?u.duplicateCount+1:u.duplicateCount,outsideDateCount:l==="outside-date"?u.outsideDateCount+1:u.outsideDateCount}))},[]),x=r.useCallback(()=>{g(l=>({...l,mode:"complete",progress:100})),setTimeout(()=>{g(l=>({...l,isVisible:!1}))},3e3)},[]),C=r.useCallback(()=>{g(l=>({...l,isVisible:!1}))},[]),w=r.useCallback(()=>{g(ce)},[]);return{overlayState:n,overlayActions:{startUpload:E,updateProgress:d,markPhotoComplete:a,finish:x,close:C,reset:w}}}const gt=({eventId:n,userId:g,uploadPhoto:E,onPhotosUploaded:d,showOverlay:a=!0})=>{const[x,C]=r.useState(!1),{toast:w}=je(),{overlayState:k,overlayActions:l}=ht(),u=async()=>{try{console.log("BatchUpload: Checking if user already participates...");const{data:f,error:p}=await N.from("event_participants").select("user_id").eq("event_id",n).eq("user_id",g).maybeSingle();if(p)throw console.error("BatchUpload: Error checking participation:",p),new Error(`Failed to check participation: ${p.message}`);if(f){console.log("BatchUpload: User already participates in event");return}console.log("BatchUpload: User does not participate, attempting to join...");const{error:v}=await N.from("event_participants").insert({event_id:n,user_id:g,roles:["guest"],auto_upload_enabled:!1,is_blocked:!1,joined_at:new Date().toISOString()});if(v)throw console.error("BatchUpload: Failed to insert participant:",v),v.message.includes("row-level security policy")?new Error("Unable to join event - please check if you have a valid invite link or permission to participate"):new Error(`Failed to join event: ${v.message}`);console.log("BatchUpload: User participation ensured")}catch(f){throw console.error("BatchUpload: Error ensuring participation:",f),f}};return{isUploading:x,uploadSelectedPhotos:async f=>{var q,R,M;if(console.log("BatchUpload: Starting batch upload with photos:",f.length),f.length===0)return w({title:"No photos selected",description:"Please select photos to upload.",variant:"destructive"}),{uploaded:0,duplicates:0,failed:0};C(!0);let p=0,v=0,P=0;try{console.log("BatchUpload: Ensuring user participation in event..."),await u(),a&&l.startUpload(f.length);for(let j=0;j<f.length;j++){const D=f[j];console.log(`BatchUpload: Processing photo ${j+1}/${f.length}:`,D.webPath);try{console.log("BatchUpload: Converting photo to data URL...");const y=await Ye(D);if(console.log("BatchUpload: Data URL length:",y.length),a){const A=((q=D.webPath)==null?void 0:q.split("/").pop())||`Photo ${j+1}`;l.updateProgress(j,A,y,0)}const z={detectedTimestamp:(R=D.timestamp)==null?void 0:R.toISOString(),confidence:D.isWithinEvent?.9:.5,withinEventTime:D.isWithinEvent||!1};if(console.log("BatchUpload: Calling uploadPhoto with timestamp info:",z),await E(y,z),p++,console.log("BatchUpload: Photo uploaded successfully, count:",p),a){const A=((M=D.webPath)==null?void 0:M.split("/").pop())||`Photo ${j+1}`;l.updateProgress(j,A,y,100),l.markPhotoComplete("success")}}catch(y){console.error("BatchUpload: Failed to upload photo:",y);let z="success";y instanceof Error&&y.message==="DUPLICATE_PHOTO"?(v++,z="duplicate",console.log("BatchUpload: Duplicate photo caught and counted")):P++,a&&y instanceof Error&&y.message==="DUPLICATE_PHOTO"&&l.markPhotoComplete("duplicate")}a&&j<f.length-1&&await new Promise(y=>setTimeout(y,300))}return console.log("BatchUpload: Final counts - uploaded:",p,"duplicates:",v,"failed:",P),a&&l.finish(),(!a||p===0&&P>0)&&(p===0&&P>0?w({title:"Upload failed",description:`Failed to upload ${P} photo${P===1?"":"s"}. Please check permissions and try again.`,variant:"destructive"}):v>0||P>0?w({title:"Upload complete!",description:`Uploaded ${p} new photo${p===1?"":"s"}. ${v>0?`Skipped ${v} duplicate${v===1?"":"s"}. `:""}${P>0?`${P} failed. `:""}`}):w({title:"Upload complete!",description:`Successfully uploaded ${p} photo${p===1?"":"s"}.`})),d&&p>0&&d(p),{uploaded:p,duplicates:v,failed:P}}catch(j){return console.error("BatchUpload: Batch upload failed:",j),a&&l.close(),w({title:"Upload failed",description:"Some photos failed to upload. Please try again.",variant:"destructive"}),{uploaded:p,duplicates:v,failed:P}}finally{C(!1)}},overlayState:k,overlayActions:l}};function ft({isVisible:n,mode:g,currentIndex:E,totalCount:d,currentFileName:a,currentThumbnail:x,progress:C,uploadedCount:w,duplicateCount:k,outsideDateCount:l,onClose:u}){return n?e.jsx("div",{className:"fixed bottom-0 left-0 right-0 z-50 border-t border-border bg-background shadow-2xl rounded-t-xl",children:e.jsx("div",{className:"p-4",children:g==="uploading"?e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"flex-shrink-0 w-16 h-16 bg-muted rounded-xl flex items-center justify-center overflow-hidden",children:x?e.jsx("img",{src:x,alt:"Upload preview",className:"w-full h-full object-cover"}):e.jsx(ee,{className:"w-8 h-8 text-muted-foreground"})}),e.jsxs("div",{className:"flex-1 min-w-0 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("p",{className:"text-base font-semibold",children:["Uploading ",E+1,"/",d]}),e.jsx(B,{variant:"ghost",size:"icon",onClick:u,className:"h-8 w-8 flex-shrink-0",children:e.jsx(de,{className:"h-4 w-4"})})]}),e.jsx("p",{className:"text-xs text-muted-foreground truncate",children:a||"Uploading..."}),e.jsx(Ue,{value:C,className:"h-2"})]})]}):e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"flex-shrink-0 w-16 h-16 bg-green-500/10 rounded-xl flex items-center justify-center",children:e.jsx(mt,{className:"w-8 h-8 text-green-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("p",{className:"text-base font-semibold",children:"Upload Complete"}),e.jsx(B,{variant:"ghost",size:"icon",onClick:u,className:"h-8 w-8 flex-shrink-0",children:e.jsx(de,{className:"h-4 w-4"})})]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:[w," Uploaded",k>0&&`, ${k} Duplicates`,l>0&&`, ${l} Outside event dates`]})]})]})})}):null}const yt=()=>{const{eventId:n}=Je(),g=Qe(),E=Xe(),{toast:d}=je(),{user:a}=Ze();Ke(),console.log("ðŸŽ¬ Camera component rendering...",{eventId:n,hasNavigationState:!!E.state,navigationState:E.state});const[x,C]=r.useState(null),[w,k]=r.useState(!1),[l,u]=r.useState(0),[o,f]=r.useState(null),[p,v]=r.useState(!0),[P,q]=r.useState([]),[R,M]=r.useState("online"),[j,D]=r.useState([]),[y,z]=r.useState(!1),[A,ue]=r.useState([]),[F,W]=r.useState(new Set);r.useState(!1);const[Se,Y]=r.useState(!1),[Ne,Ce]=r.useState(""),[_e,Te]=r.useState(!0),[Ee,ke]=r.useState(!1),H=r.useRef([]),pe=r.useRef();r.useEffect(()=>{const t=E.state;t!=null&&t.capturedImage&&C(t.capturedImage),t!=null&&t.galleryPhotos&&(console.log("ðŸ” === GALLERY PHOTOS LOADED FROM NAVIGATION ==="),console.log("ðŸ” Number of photos:",t.galleryPhotos.length),t.galleryPhotos.forEach((m,U)=>{console.log(`ðŸ” Photo ${U}:`,{id:m.id,withinEvent:m.withinEvent,originalTimestamp:m.originalTimestamp,timestampSource:m.timestampSource,hasDataUrl:!!m.dataUrl})}),ue(t.galleryPhotos),W(t.selectedPhotos||new Set)),me();const i=()=>M("online"),c=()=>M("offline");window.addEventListener("online",i),window.addEventListener("offline",c),te();const O=setInterval(te,5e3);return()=>{window.removeEventListener("online",i),window.removeEventListener("offline",c),clearInterval(O),pe.current&&clearInterval(pe.current)}},[n,a==null?void 0:a.id,E.state]),r.useEffect(()=>(o&&(window.__PHOTOSHARE_EVENT_DATA={eventId:o.id,eventName:o.name,startTime:o.startTime,endTime:o.endTime},console.log("ðŸ“Š Exposed event data globally for native integration:",window.__PHOTOSHARE_EVENT_DATA)),()=>{delete window.__PHOTOSHARE_EVENT_DATA}),[o]),r.useEffect(()=>{a!=null&&a.id&&n&&(console.log("User available, loading preferences..."),De())},[a==null?void 0:a.id,n]);const me=async()=>{try{if(!n)return;const{data:t,error:i}=await N.from("events").select("*").eq("event_id",n).single();if(i){console.error("Error loading event:",i),d({title:"Failed to load event",description:"Could not find the event details.",variant:"destructive"}),g("/dashboard");return}const{count:c}=await N.from("event_participants").select("*",{count:"exact",head:!0}).eq("event_id",n),{count:O}=await N.from("media").select("*",{count:"exact",head:!0}).eq("event_id",n).eq("is_visible",!0),m=new Date,U=new Date(t.start_time),h=new Date(t.end_time),s=t.timezone||"UTC",b=ve(U,s),S=ve(h,s),se=m>=b&&m<=S,oe=m>S,V=se||oe&&t.allow_uploads_after_end;console.log("Event timezone setup:",{eventTz:s,startTimeUTC:U.toISOString(),endTimeUTC:h.toISOString(),startTimeInEventTz:b.toISOString(),endTimeInEventTz:S.toISOString(),startTimeLocal:b.toLocaleString(),endTimeLocal:S.toLocaleString()}),f({id:t.event_id,name:et(t.name),status:t.status,isActive:V,startTime:b.toISOString(),endTime:S.toISOString(),timezone:s,allow_uploads_after_end:t.allow_uploads_after_end,participantCount:c||0,photoCount:O||0}),v(V)}catch(t){console.error("Failed to load event:",t),d({title:"Error",description:"Failed to load event data.",variant:"destructive"})}},te=async()=>{try{if(!n)return;const{data:t,error:i}=await N.from("media").select("*").eq("event_id",n).eq("is_visible",!0).order("upload_time",{ascending:!1}).limit(6);if(i){console.error("Error loading photos:",i);return}const c=[...new Set(t.map(h=>h.uploader_id))],O=await tt(c),m=new Map;O.forEach(h=>{const s=at(h);m.set(h.user_id,s)});const U=t.map(h=>{let s="User";return h.uploader_id===(a==null?void 0:a.id)?s="You":s=m.get(h.uploader_id)||"User",{id:h.media_id,url:h.file_url,thumbnailUrl:h.file_url,uploadedBy:s,uploadedAt:h.upload_time,likes:0,comments:0,isOwn:h.uploader_id===(a==null?void 0:a.id)}});q(U)}catch(t){console.error("Failed to load photos:",t)}},De=async()=>{try{if(console.log("Loading user preferences - eventId:",n,"userId:",a==null?void 0:a.id),!n||!(a!=null&&a.id)){console.log("Missing eventId or userId, skipping preference load");return}const{data:t,error:i}=await N.from("event_participants").select("auto_upload_enabled").eq("event_id",n).eq("user_id",a.id).maybeSingle();if(i&&i.code!=="PGRST116"){console.error("Error loading user preferences:",i);return}if(console.log("Participant data loaded:",t),t){const c=t.auto_upload_enabled||!1;console.log("Setting auto-upload to:",c),z(c)}else console.log("User not a participant yet, will be added when auto-upload is first enabled"),z(!1)}catch(t){console.error("Failed to load user preferences:",t)}},Ie=async()=>{try{if(!n||!(a!=null&&a.id))return;console.log("Ensuring user participation for:",{eventId:n,userId:a.id});const{error:t}=await N.from("event_participants").upsert({event_id:n,user_id:a.id,roles:["guest"],auto_upload_enabled:!1,is_blocked:!1,joined_at:new Date().toISOString()},{onConflict:"event_id,user_id"});t?console.error("Error ensuring user participation:",t):console.log("User participation ensured successfully")}catch(t){console.error("Failed to ensure user participation:",t)}},{takePicture:Oe,isTakingPicture:Ae}=st(),J=async()=>{const t=await nt();if(!t.granted){Ce(t.message||"Camera access is required to take photos"),Te(t.canPrompt||!1),Y(!0);return}console.log("ðŸ“¸ Camera button pushed - Platform info:",{buttonPushed:"camera",isCapacitorNative:K.isNativePlatform(),capacitorPlatform:K.getPlatform(),platform:K.getPlatform(),timestamp:new Date().toISOString()});const i=await Oe();if(!i)return;const c=new FileReader;c.onload=O=>{var U;const m=(U=O.target)==null?void 0:U.result;m&&(C(m),d({title:"Photo captured!",description:"Your photo is ready to upload."}))},c.readAsDataURL(i)},Be=async()=>{const t=await rt();Y(!1),t.granted?J():d({title:"Permission Denied",description:t.message||"Camera permission is required to take photos",variant:"destructive"})},Fe=async()=>{Y(!1);try{await lt()||(K.isNativePlatform()?d({title:"Manual Settings Required",description:"Please go to your device Settings > Apps > PhotoShare > Permissions and enable Camera access.",variant:"destructive"}):d({title:"Camera Access",description:"Please allow camera access when prompted by your browser, or check your browser's camera settings."}))}catch(t){console.error("Error in handleOpenSettings:",t),d({title:"Settings Error",description:"Unable to open app settings. Please manually enable camera permissions in your device settings.",variant:"destructive"})}},ae=async(t,i)=>{var O,m,U,h;const c=t||x;if(!c){console.error("ðŸš€ No image data available for upload"),d({title:"No image to upload",description:"Please take a photo first or select one from your gallery.",variant:"destructive"});return}if(!(a!=null&&a.id)){console.error("ðŸš€ No user ID available"),d({title:"Authentication error",description:"Please sign in again to upload photos.",variant:"destructive"});return}if(!n){console.error("ðŸš€ No event ID available"),d({title:"Event error",description:"Unable to determine which event to upload to.",variant:"destructive"});return}if(!c.startsWith("data:image/")){console.error("ðŸš€ Invalid image data format:",c.substring(0,50)),d({title:"Invalid image data",description:"The image data is not in the correct format.",variant:"destructive"});return}console.log("ðŸš€ Starting upload process..."),console.log("ðŸš€ Target image format:",c.substring(0,50)+"..."),console.log("ðŸš€ User ID:",a==null?void 0:a.id),console.log("ðŸš€ Event ID:",n),i?console.log("ðŸš€ Batch upload: Participation handled by batch hook"):(console.log("ðŸš€ Single upload: Ensuring user participation in event..."),await Ie()),k(!0),u(0);try{let s;if(i?s=i:(console.log("ðŸš€ Extracting timestamp from image..."),s=await ct(c),s.originalTimestamp||(s=dt())),o!=null&&o.startTime&&(o!=null&&o.endTime)){const _=new Date(o.startTime),L=new Date(o.endTime),T=s.originalTimestamp,G=new Date,X=G>=_&&(G<=L||o.allow_uploads_after_end);console.log("â±ï¸ Upload-time timestamp check:",{tsISO:(T==null?void 0:T.toISOString())||"none",eventStartISO:_.toISOString(),eventEndISO:L.toISOString(),timezone:o.timezone,isEventCurrentlyActive:X,hasTimestamp:!!T});let $;if(T?$=ut(T,_,L,o.timezone):$=X,!$){d({title:"Photo outside event timeframe",description:T?"This photo was not taken during the event dates and was skipped.":"Unable to verify photo timestamp. Please take photos during the event or enable uploads after event ends.",variant:"destructive"}),k(!1);return}}else{console.warn("âš ï¸ Event start/end not available during upload validation; blocking to be safe"),d({title:"Event data unavailable",description:"Unable to verify event dates right now. Please try again.",variant:"destructive"}),k(!1);return}console.log("ðŸš€ Converting data URL to blob..."),console.log("ðŸš€ Data URL length:",c.length),console.log("ðŸš€ Data URL prefix:",c.substring(0,100));const b=_=>{const[L,T]=_.split(","),G=L.match(/data:(.*?);base64/),X=G?G[1]:"image/jpeg",$=atob(T),ge=$.length,fe=new Uint8Array(ge);for(let Z=0;Z<ge;Z++)fe[Z]=$.charCodeAt(Z);return new Blob([fe],{type:X})};let S;try{S=b(c),console.log("ðŸš€ Blob created via base64 decode, size:",S.size,"type:",S.type)}catch(_){throw console.error("ðŸš€ Failed to process data URL:",_),new Error("Unable to process image data locally.")}console.log("ðŸš€ Generating file hash...");const{generateFileHash:se,checkDuplicatePhoto:oe}=await pt(async()=>{const{generateFileHash:_,checkDuplicatePhoto:L}=await import("./index-DJafiPoS.js").then(T=>T.cU);return{generateFileHash:_,checkDuplicatePhoto:L}},__vite__mapDeps([0,1])),V=await se(S);if(u(10),console.log("ðŸš€ Checking for duplicates..."),await oe(n,V,N)){if(console.log("ðŸš€ Duplicate photo detected"),i)throw new Error("DUPLICATE_PHOTO");d({title:"Duplicate photo detected",description:"This photo has already been uploaded to this event.",variant:"destructive"});return}const Ve=Date.now(),ie=`${n}/${a.id}/${Ve}.jpg`;console.log("ðŸš€ Upload filename:",ie),u(20),console.log("ðŸš€ Uploading to Supabase Storage...");const{data:Ge,error:ne}=await N.storage.from("event-photos").upload(ie,S,{contentType:S.type||"image/jpeg",upsert:!1});if(ne)throw console.error("ðŸš€ Supabase storage upload error:",ne),ne;console.log("ðŸš€ Upload successful:",Ge),u(60),console.log("ðŸš€ Getting public URL...");const{data:{publicUrl:Q}}=N.storage.from("event-photos").getPublicUrl(ie);console.log("ðŸš€ Public URL:",Q),u(80),console.log("ðŸš€ Saving media record to database...");const{data:re,error:le}=await N.from("media").insert({event_id:n,uploader_id:a.id,file_url:Q,media_type:"photo",device_id:a.id,is_visible:!0,original_timestamp:(O=s.originalTimestamp)==null?void 0:O.toISOString(),capture_method:s.captureMethod,metadata:s.metadata,file_hash:V}).select().single();if(le)throw console.error("ðŸš€ Database insert error:",le),le;console.log("ðŸš€ Media record saved:",re),u(100);const We={id:re.media_id,url:Q,thumbnailUrl:Q,uploadedBy:"You",uploadedAt:re.upload_time,likes:0,comments:0,isOwn:!0};q(_=>[We,..._.slice(0,5)]),d({title:"Photo uploaded! ðŸ“¸",description:"Your photo is now live in the event gallery."}),me(),setTimeout(()=>{g(`/event/${n}`)},1500)}catch(s){if(console.error("ðŸš€ Upload failed:",s),console.log("ðŸš€ Error type:",typeof s),console.log("ðŸš€ Error message:",s==null?void 0:s.message),console.log("ðŸš€ Full error object:",JSON.stringify(s,null,2)),R==="offline")H.current.push(x),D(b=>[...b,x]),d({title:"Saved for later",description:"Photo will upload when connection is restored."});else{let b="Please try again or check your connection.";(m=s==null?void 0:s.message)!=null&&m.includes("Failed to fetch")?b="Network error: Unable to process image data. Please check your connection and try again.":(U=s==null?void 0:s.message)!=null&&U.includes("storage")?b="Storage error: Unable to upload photo. Please try again.":(h=s==null?void 0:s.message)!=null&&h.includes("duplicate")?b="This photo has already been uploaded.":s!=null&&s.message&&(b=s.message),d({title:"Upload failed",description:b,variant:"destructive"})}}finally{k(!1)}},{isUploading:he,uploadSelectedPhotos:Re,overlayState:I,overlayActions:ze}=gt({eventId:n,userId:a==null?void 0:a.id,uploadPhoto:ae,onPhotosUploaded:t=>{ue([]),W(new Set),te(),setTimeout(()=>{g(`/event/${n}`)},1500)}}),Le=async()=>{if(H.current.length===0)return;const t=[...H.current];H.current=[],D([]);for(const i of t)C(i),await ae()};r.useEffect(()=>{R==="online"&&H.current.length>0&&Le()},[R]);const $e=()=>{C(null),u(0),setTimeout(()=>{J()},100)},qe=async()=>{const t=A.filter(i=>F.has(i.id)).map(i=>({webPath:i.dataUrl,timestamp:i.originalTimestamp,isWithinEvent:i.withinEvent,selected:!0,format:"jpeg"}));if(t.length===0){d({title:"No photos selected",description:"Please select photos to upload.",variant:"destructive"});return}await Re(t)},Me=t=>{W(i=>{const c=new Set(i);return c.has(t)?c.delete(t):c.add(t),c})},He=()=>{W(new Set)};return e.jsxs("div",{className:"min-h-screen bg-background flex flex-col font-outfit",children:[e.jsx("header",{className:"sticky top-0 z-40 bg-background/80 backdrop-blur-md border-b border-border",children:e.jsx("div",{className:"container mx-auto px-4 py-3",children:e.jsxs(B,{variant:"ghost",className:"gap-2",onClick:()=>g(`/event/${n}`),children:[e.jsx(ot,{className:"h-5 w-5"}),"Back"]})})}),e.jsx("div",{className:"flex-1 flex flex-col p-4 space-y-4",children:x?e.jsx(xe,{className:"w-full max-w-md mx-auto",children:e.jsxs(we,{className:"p-0",children:[e.jsx("div",{className:"aspect-square overflow-hidden rounded-t-lg",children:e.jsx("img",{src:x,alt:"Captured",className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"p-4 space-y-4",children:[w?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:"Uploading to gallery..."}),e.jsxs("span",{children:[Math.round(l),"%"]})]}),e.jsx(Ue,{value:l,className:"w-full"})]}):e.jsx("p",{className:"text-center text-sm text-muted-foreground",children:"Great shot! Upload to share with other guests."}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsxs(B,{variant:"outline",className:"flex-1",onClick:$e,disabled:w,children:[e.jsx(de,{className:"h-4 w-4 mr-2"}),"Retake"]}),e.jsx(B,{className:"flex-1 camera-button",onClick:()=>ae(),disabled:w,children:w?e.jsxs(e.Fragment,{children:[e.jsx(ee,{className:"h-4 w-4 mr-2 animate-spin"}),"Uploading..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ee,{className:"h-4 w-4 mr-2"}),"Upload"]})})]})]})]})}):e.jsxs("div",{className:"space-y-6",children:[A.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"container mx-auto px-4 py-4",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Upload Photos"}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["Select photos to upload to ",o==null?void 0:o.name]}),(o==null?void 0:o.startTime)&&(o==null?void 0:o.endTime)&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Event: ",be(new Date(o.startTime),"MMM d, yyyy h:mm a")," - ",be(new Date(o.endTime),"MMM d, yyyy h:mm a")," ",o.timezone?`(${o.timezone})`:""]})]}),e.jsx("div",{className:"container mx-auto px-4 pb-32",children:e.jsx("div",{className:"grid grid-cols-3 gap-2",children:A.map(t=>{const i=F.has(t.id);return e.jsx("div",{className:"cursor-pointer",children:e.jsxs("div",{onClick:()=>Me(t.id),className:"relative aspect-square hover:opacity-90 transition-opacity",children:[e.jsx("img",{src:t.dataUrl,alt:"Gallery photo",className:`w-full h-full object-cover rounded-lg ${i?"border-2 border-primary":""}`}),i&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"absolute inset-0 bg-primary/20 rounded-lg"}),e.jsx("div",{className:"absolute top-1 right-1 h-7 w-7 rounded-full bg-primary flex items-center justify-center shadow-lg",children:e.jsx("svg",{className:"h-4 w-4 text-primary-foreground",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})})]})]})},t.id)})})}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-background/95 backdrop-blur-sm border-t border-border p-4 safe-area-bottom",children:e.jsxs("div",{className:"container mx-auto flex items-center justify-between gap-4",children:[e.jsx(B,{variant:"ghost",size:"sm",onClick:He,disabled:F.size===0,children:"Deselect All"}),e.jsx("div",{className:"flex-1"}),e.jsx(B,{onClick:qe,disabled:F.size===0||he,className:"camera-button gap-2",size:"lg",children:he?e.jsxs(e.Fragment,{children:[e.jsx(ye,{className:"h-4 w-4 animate-spin"}),"Uploading ",F.size," ",F.size===1?"Photo":"Photos"]}):e.jsxs(e.Fragment,{children:[e.jsx(ee,{className:"h-4 w-4"}),"Upload ",F.size," ",F.size===1?"Photo":"Photos"]})})]})})]}),!x&&A.length===0&&e.jsx(xe,{className:"w-full max-w-md mx-auto event-card",children:e.jsx(we,{className:"p-8",children:Ee?e.jsxs("div",{className:"flex flex-col items-center justify-center space-y-4 py-6",children:[e.jsx("p",{className:"text-sm text-center text-muted-foreground",children:"For your browser's security, please tap below to open the camera."}),e.jsxs(B,{className:"camera-button gap-2",size:"lg",onClick:()=>{ke(!1),J()},children:[e.jsx(Pe,{className:"h-4 w-4"}),"Open Camera"]})]}):Ae?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(ye,{className:"h-8 w-8 animate-spin text-primary mb-4"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Preparing camera..."})]}):e.jsx("div",{className:"flex flex-col items-center justify-center space-y-4 py-6",children:e.jsxs(B,{className:"camera-button gap-2",size:"lg",onClick:J,children:[e.jsx(Pe,{className:"h-4 w-4"}),"Take Photo"]})})})})]})}),!x&&A.length===0&&e.jsxs("div",{className:"text-center p-4 space-y-2",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["ðŸ’¡ ",e.jsx("strong",{children:"Pro tip:"})," Photos upload instantly and appear in the live gallery"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:R==="online"?"Connected â€¢ Real-time uploads enabled":"Offline â€¢ Photos will upload when reconnected"})]}),e.jsx(it,{isOpen:Se,onClose:()=>Y(!1),onRequestPermission:Be,onOpenSettings:Fe,message:Ne,canPrompt:_e}),e.jsx(ft,{isVisible:I.isVisible,mode:I.mode,currentIndex:I.currentIndex,totalCount:I.totalCount,currentFileName:I.currentFileName,currentThumbnail:I.currentThumbnail,progress:I.progress,uploadedCount:I.uploadedCount,duplicateCount:I.duplicateCount,outsideDateCount:I.outsideDateCount,onClose:ze.close})]})};export{yt as default};
