import{K as z,u as Q,a as T,r as $,bi as B,bj as E,j as e,p as y,B as m,ak as C,k as A,am as k,au as F,bk as S,Q as D,ax as R,bl as H,bm as I,s as q}from"./index-PUmVADdG.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=z("Timer",[["line",{x1:"10",x2:"14",y1:"2",y2:"2",key:"14vaq8"}],["line",{x1:"12",x2:"15",y1:"14",y2:"11",key:"17fdiu"}],["circle",{cx:"12",cy:"14",r:"8",key:"1e1u0o"}]]),O=({headerImageUrl:u,qrCodeImageUrl:h,onHeaderImageChange:f,onQrCodeImageChange:j})=>{const{user:p}=Q(),{toast:a}=T(),[l,b]=$.useState(null),{pickSinglePhoto:U,isPickingPhoto:d}=B(),n=E({mode:"crop-header"}),c=E({mode:"crop-qr"}),v=async(t,s)=>{if(!p){a({title:"Authentication required",description:"Please log in to upload images",variant:"destructive"});return}b(s);try{const o=t.name.split(".").pop(),x=`branding/temp/${p.id}/${s}-${Date.now()}.${o}`,{data:r,error:i}=await q.storage.from("event-photos").upload(x,t,{cacheControl:"3600",upsert:!1});if(i)throw i;const{data:{publicUrl:g}}=q.storage.from("event-photos").getPublicUrl(x);s==="header"?f(g):j(g),a({title:"Success",description:`${s==="header"?"Header":"QR code"} image uploaded successfully`})}catch(o){console.error("Upload error:",o),a({title:"Upload failed",description:o.message||"Failed to upload image",variant:"destructive"})}finally{b(null)}},w=t=>{t==="header"?f(void 0):j(void 0)},N=async t=>{if(!p){a({title:"Authentication required",description:"Please sign in to upload images",variant:"destructive"});return}try{const s=await U({purpose:t==="header"?"header":"qr",allowEditing:R.getPlatform()==="ios",maxWidth:t==="header"?1920:1080,maxHeight:1080});if(!s)return;if(!s.type.startsWith("image/")){a({title:"Invalid file type",description:"Please select an image file",variant:"destructive"});return}if(s.size>10*1024*1024){a({title:"File too large",description:"Please select an image smaller than 10MB",variant:"destructive"});return}if(R.getPlatform()==="ios")await v(s,t);else{const r=await(t==="header"?n:c).editPhoto(s);if(r.edited&&r.webPath){let i;if(H(r.webPath))i=I(r.webPath,s.name,"image/jpeg");else{const P=await(await fetch(r.webPath)).blob();i=new File([P],s.name,{type:P.type||"image/jpeg"})}await v(i,t)}}}catch(s){console.error("Error selecting/editing photo:",s),a({title:"Error",description:"Failed to select or edit image",variant:"destructive"})}};return e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs(y,{className:"text-sm font-medium",children:["Header Image",e.jsx("span",{className:"text-muted-foreground font-normal ml-1 text-xs",children:"(1920x480px recommended)"})]}),u?e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-full h-24 overflow-hidden rounded-lg bg-muted border",children:e.jsx("img",{src:u,alt:"Header preview",className:"w-full h-full object-cover object-center"})}),e.jsx(m,{type:"button",variant:"destructive",size:"sm",className:"absolute top-1 right-1 h-6 w-6 p-0",onClick:()=>w("header"),children:e.jsx(C,{className:"h-3 w-3"})})]}):e.jsxs("div",{className:"border-2 border-dashed border-muted-foreground/25 rounded-lg p-4 text-center bg-muted/10",children:[e.jsx(A,{className:"h-8 w-8 mx-auto text-muted-foreground mb-2"}),e.jsx("p",{className:"text-xs text-muted-foreground mb-2",children:"No header image"})]}),e.jsx(m,{type:"button",variant:"outline",size:"sm",disabled:l==="header"||d||n.isEditing,onClick:()=>N("header"),className:"w-full text-xs",children:l==="header"?e.jsxs(e.Fragment,{children:[e.jsx(k,{className:"h-3 w-3 mr-2 animate-spin"}),"Uploading..."]}):d||n.isEditing?e.jsxs(e.Fragment,{children:[e.jsx(F,{className:"h-3 w-3 mr-2 animate-spin"}),n.isEditing?"Cropping...":"Selecting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(S,{className:"h-3 w-3 mr-2"}),u?"Replace & Crop":"Select & Crop"]})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs(y,{className:"text-sm font-medium",children:["Custom QR Code",e.jsx("span",{className:"text-muted-foreground font-normal ml-1 text-xs",children:"(512x512px recommended)"})]}),h?e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-24 h-24 overflow-hidden rounded-lg bg-muted border mx-auto",children:e.jsx("img",{src:h,alt:"QR code preview",className:"w-full h-full object-cover object-center"})}),e.jsx(m,{type:"button",variant:"destructive",size:"sm",className:"absolute top-1 right-1 h-6 w-6 p-0",onClick:()=>w("qr"),children:e.jsx(C,{className:"h-3 w-3"})})]}):e.jsxs("div",{className:"border-2 border-dashed border-muted-foreground/25 rounded-lg p-4 text-center bg-muted/10",children:[e.jsx(D,{className:"h-8 w-8 mx-auto text-muted-foreground mb-2"}),e.jsx("p",{className:"text-xs text-muted-foreground mb-2",children:"No custom QR code"})]}),e.jsx(m,{type:"button",variant:"outline",size:"sm",disabled:l==="qr"||d||c.isEditing,onClick:()=>N("qr"),className:"w-full text-xs",children:l==="qr"?e.jsxs(e.Fragment,{children:[e.jsx(k,{className:"h-3 w-3 mr-2 animate-spin"}),"Uploading..."]}):d||c.isEditing?e.jsxs(e.Fragment,{children:[e.jsx(F,{className:"h-3 w-3 mr-2 animate-spin"}),c.isEditing?"Cropping...":"Selecting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(S,{className:"h-3 w-3 mr-2"}),h?"Replace & Crop":"Select & Crop"]})})]})]})})};export{O as E,W as T};
