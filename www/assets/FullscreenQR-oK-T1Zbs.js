import{ai as E,u as I,b as C,a as _,r as i,aj as k,s as g,j as e,ak as O}from"./index-DJafiPoS.js";const q=n=>{const o=["AMAZING","EPIC","MAGICAL","SUNNY","GOLDEN","BRIGHT"],a=["PARTY","EVENT","CELEBRATION","GATHERING","MOMENTS","MEMORIES"],r=n.replace(/-/g,"").toLowerCase(),d=parseInt(r.slice(0,2),16)%o.length,t=parseInt(r.slice(2,4),16)%a.length,u=parseInt(r.slice(4,6),16)%100;return`${o[d]}${a[t]}${u}`},S=()=>{const{eventId:n}=E(),{user:o}=I(),a=C(),{toast:r}=_(),d=i.useRef(null),[t,u]=i.useState(null),[h,j]=i.useState(!0),[c,b]=i.useState(null);i.useEffect(()=>{N()},[n,o]),i.useEffect(()=>{if(t&&!c){const l=new k({width:400,height:400,type:"svg",data:`https://photo-share.app/join/${t.eventCode}${t.passcode?`?passcode=${t.passcode}`:""}`,image:t.qrCodeImageUrl||"/favicon.ico",dotsOptions:{color:"hsl(217, 91%, 60%)",type:"rounded"},backgroundOptions:{color:"transparent"},imageOptions:{crossOrigin:"anonymous",margin:5},cornersSquareOptions:{color:"hsl(330, 85%, 60%)",type:"extra-rounded"},cornersDotOptions:{color:"hsl(270, 95%, 75%)",type:"dot"}});b(l),d.current&&l.append(d.current)}},[t,c]),i.useEffect(()=>{c&&t&&c.update({image:t.qrCodeImageUrl||"/favicon.ico"})},[t==null?void 0:t.qrCodeImageUrl,c]);const N=async()=>{var l,x,p,f;try{if(!n)return;const{data:s,error:v}=await g.from("events").select(`
          event_id,
          name,
          owner_id,
          passcode,
          qr_code_image_url,
          invite_links(
            link
          )
        `).eq("event_id",n).maybeSingle();if(v){console.error("Error loading event:",v),r({title:"Failed to load event",description:"Please try again.",variant:"destructive"});return}if(!s){r({title:"Event not found",description:"The event you're looking for doesn't exist.",variant:"destructive"}),a("/dashboard");return}if(o){const{data:m}=await g.from("event_participants").select("roles").eq("event_id",n).eq("user_id",o.id).single(),y=o.id===s.owner_id,w=(l=m==null?void 0:m.roles)==null?void 0:l.includes("organizer");if(!y&&!w){r({title:"Access denied",description:"Only event owners and organizers can access fullscreen QR mode.",variant:"destructive"}),a(`/event/${n}`);return}}else{a("/");return}u({name:s.name,eventCode:((f=(p=(x=s.invite_links)==null?void 0:x[0])==null?void 0:p.link)==null?void 0:f.split("/").pop())||q(s.event_id),passcode:s.passcode||void 0,ownerId:s.owner_id,qrCodeImageUrl:s.qr_code_image_url||void 0})}catch(s){console.error("Failed to load event:",s),r({title:"Failed to load event",description:"Please try again.",variant:"destructive"})}finally{j(!1)}};return h?e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading QR code..."})]})}):t?e.jsxs("div",{className:"min-h-screen bg-background flex flex-col items-center justify-center p-4 sm:p-8 relative",children:[e.jsx("button",{onClick:()=>a(`/event/${n}`),className:"absolute top-4 left-4 p-2 hover:opacity-70 transition-opacity","aria-label":"Close fullscreen view",children:e.jsx(O,{className:"h-6 w-6 text-foreground"})}),e.jsxs("div",{className:"flex flex-col items-center justify-center max-w-lg mx-auto w-full space-y-4 sm:space-y-6 px-4",children:[e.jsx("div",{className:"bg-muted/30 rounded-2xl shadow-2xl border border-primary/20 flex items-center justify-center overflow-hidden",children:e.jsx("div",{ref:d,className:"w-[320px] h-[320px] sm:w-[400px] sm:h-[400px] flex items-center justify-center"})}),e.jsx("div",{className:"text-center",children:e.jsx("h1",{className:"text-xl sm:text-2xl md:text-3xl font-bold text-foreground",children:t.name})}),e.jsxs("div",{className:"bg-muted/50 rounded-lg p-4 w-full text-center space-y-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Event Code"}),e.jsx("code",{className:"text-xl sm:text-2xl md:text-3xl font-bold font-mono tracking-wider text-foreground",children:t.eventCode})]}),t.passcode&&e.jsxs("div",{className:"pt-2 border-t border-border",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Passcode"}),e.jsx("code",{className:"text-lg sm:text-xl md:text-2xl font-bold font-mono tracking-wider text-foreground",children:t.passcode})]}),e.jsx("p",{className:"text-sm text-muted-foreground pt-2",children:"Scan to join or enter the code above"})]})]})]}):e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsx("div",{className:"text-center",children:e.jsx("p",{className:"text-muted-foreground",children:"Event not found."})})})};export{S as default};
